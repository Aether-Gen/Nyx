<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NYX — GPN Viewer (CSV)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #071d2f;
  color: #cfe6ff;
  font-family: system-ui, sans-serif;
}
#ui {
  position: fixed;
  left: 0; top: 0; bottom: 0;
  width: 280px;
  background: linear-gradient(#0b2a44, #071d2f);
  padding: 14px;
  overflow-y: auto;
}
#canvasWrap {
  margin-left: 280px;
}
canvas {
  display: block;
}
label {
  display: block;
  font-size: 12px;
  margin-top: 10px;
}
input, button {
  width: 100%;
  margin-top: 4px;
}
#hud {
  position: fixed;
  left: 280px;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,.5);
  padding: 6px 10px;
  font-size: 13px;
}
</style>
</head>

<body>

<div id="ui">
  <h3>NYX — GPN Viewer</h3>

  <label>CSV (mesma pasta)</label>
  <input id="csvFile" value="hex_grid.csv">
  <button onclick="loadCSV()">Carregar CSV</button>

  <label>Hex size</label>
  <input id="hexSize" value="11">

  <label>Step X</label>
  <input id="stepX" value="18">

  <label>Step Y</label>
  <input id="stepY" value="10">

  <label>Offset X</label>
  <input id="offX" value="30">

  <label>Offset Y</label>
  <input id="offY" value="30">

  <button onclick="render()">Aplicar</button>
</div>

<div id="canvasWrap">
  <canvas id="cv"></canvas>
</div>

<div id="hud">Hover: —</div>

<script>
const canvas = document.getElementById('cv');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');

let GRID = [];
let COLS = 0;
let ROWS = 0;

function resize(){
  canvas.width  = window.innerWidth - 280;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function loadCSV(){
  const file = document.getElementById('csvFile').value;
  fetch(file).then(r=>r.text()).then(t=>{
    parseCSV(t);
    render();
  });
}

function parseCSV(text){
  GRID = [];
  const lines = text.split(/\r?\n/).filter(l=>l.trim()!=="");
  for(const line of lines){
    const row = line.split(',').map(v=>v.trim());
    GRID.push(row);
  }
  ROWS = GRID.length;
  COLS = Math.max(...GRID.map(r=>r.length));
}

function hexPath(x,y,s){
  const h = s;
  const w = Math.sqrt(3)/2 * h;
  ctx.beginPath();
  ctx.moveTo(x, y-h);
  ctx.lineTo(x+w, y-h/2);
  ctx.lineTo(x+w, y+h/2);
  ctx.lineTo(x, y+h);
  ctx.lineTo(x-w, y+h/2);
  ctx.lineTo(x-w, y-h/2);
  ctx.closePath();
}

function render(){
  const s  = +hexSize.value;
  const sx = +stepX.value;
  const sy = +stepY.value;
  const ox = +offX.value;
  const oy = +offY.value;

  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const id = GRID[r][c];
      if(!id) continue;

      const x = ox + c * sx;
      const y = oy + r * sy;

      hexPath(x,y,s);
      ctx.strokeStyle = "#355f7a";
      ctx.stroke();
    }
  }
}

canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  let best=null, bd=1e9;

  const s  = +hexSize.value;
  const sx = +stepX.value;
  const sy = +stepY.value;
  const ox = +offX.value;
  const oy = +offY.value;

  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const id = GRID[r][c];
      if(!id) continue;
      const x = ox + c*sx;
      const y = oy + r*sy;
      const d = (mx-x)**2 + (my-y)**2;
      if(d<bd){
        bd=d;
        best={r,c,id,x,y};
      }
    }
  }

  if(best){
    render();
    hexPath(best.x,best.y,s);
    ctx.strokeStyle="#00bfff";
    ctx.lineWidth=2;
    ctx.stroke();
    ctx.lineWidth=1;

    hud.textContent =
      `Hover: col=${best.c}, lin=${best.r} | hexFuncID=${best.id}`;
  }
});
</script>

</body>
</html>
